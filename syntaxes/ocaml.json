{
  "scopeName": "source.ocaml",
  "fileTypes": [
    "ml",
    "mli"
  ],
  "patterns": [
    { "include": "#module-item" }
  ],
  "repository": {
    "attribute": {
      "begin": "(?=\\[(@{1,3})[[:space:]]*[A-Za-z])",
      "end": "\\]",
      "patterns": [
        {
          "begin": "\\[(@{1,3})",
          "end": "(?=[[:space:]:?\\]])",
          "applyEndPatternLast": true,
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#attribute-identifier" }
          ]
        },
        {
          "begin": "(:)",
          "end": "(?=\\])",
          "beginCaptures": {
            "1": { "name": "keyword.operator" }
          },
          "patterns": [
            { "include": "#type-expression" }
          ]
        },
        {
          "begin": "",
          "end": "(?=\\])",
          "patterns": [
            {
              "comment": "FIXME: should be module-items",
              "include": "#value"
            }
          ]
        }
      ]
    },
    "attribute-identifier": {
      "patterns": [
        {
          "match": "\\b([A-Za-z][A-Za-z0-9_']*)\\b[[:space:]]*(?:(\\.))",
          "captures": {
            "1": { "name": "entity.name.class" },
            "2": { "name": "keyword.operator" }
          }
        },
        {
          "name": "constant.language",
          "match": "\\b[A-Za-z][_\\'0-9A-Za-z]*\\b"
        }
      ]
    },
		"comment": {
			"name": "comment.ocaml",
			"patterns": [
				{ "include": "#comment-block-doc" },
				{	"include": "#comment-block"	}
			]
		},
		"comment-block": {
			"begin": "\\(\\*",
			"end": "\\*\\)",
			"name": "comment.block.ocaml",
      "patterns": [
        { "include": "#comment" }
      ]
		},
		"comment-block-doc": {
			"begin": "\\(\\*\\*(?!\\))",
			"end": "\\*\\)",
			"name": "comment.block.documentation.ocaml"
		},
    "module-item": {
      "patterns": [
        { "include": "#attribute" },
        { "include": "#comment" },
        { "include": "#module-item-include" },
        { "include": "#module-item-let" },
        { "include": "#module-item-in" },
        { "include": "#module-item-module-type" },
        { "include": "#module-item-module" },
        { "include": "#module-item-open" },
        { "include": "#module-item-type" }
      ]
    },
    "module-expression": {
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-parens" },
        {
          "patterns": [
            { "include": "#module-expression-path" },
            {
              "match": "\\b([A-Z][_'0-9A-Za-z]*)\\b",
              "captures": {
                "1": { "name": "name.entity.class" }
              }
            }
          ]
        },
        { "include": "#module-expression-block" }
      ]
    },
    "module-expression-block": {
      "begin": "\\b(sig|struct)\\b",
      "end": "\\b(end)\\b",
      "captures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-item" }
      ]
    },
    "module-expression-parens": {
      "begin": "\\((?!\\*)",
      "end": "\\)",
      "patterns": [
        { "include": "#module-expression-unpack" },
        { "include": "#module-expression" }
      ]
    },
    "module-expression-path": {
      "match": "\\b([A-Z][A-Za-z0-9_']*)\\b[[:space:]]*(\\.)",
      "captures": {
        "1": { "name": "entity.name.class" },
        "2": { "name": "keyword.operator" }
      }
    },
    "module-expression-unpack": {
      "begin": "\\b(val)\\b",
      "end": "(?=\\))",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      }
    },
    "module-item-in": {
      "begin": "\\b(in)\\b",
      "end": "(?=[\\)\\]\\|]|\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#value" }
      ]
    },
    "module-item-include": {
      "begin": "\\b(include)\\b",
      "end": "(?=\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "module-item-let": {
      "comment": "FIXME: move external to separate rule",
      "begin": "\\b(external|let)\\b|\\b((?<!\\()val)\\b",
      "end": "(?=[\\)\\]\\|]|\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" },
        "2": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-let-module" },
        { "include": "#module-item-let-value" }
      ]
    },
    "module-item-let-module": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(module)\\b",
      "end": "(?=[\\)\\]]|\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-let-module-and" },
        { "include": "#module-item-let-module-rec" },
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-let-module-and": {
      "begin": "\\b(and)\\b",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-let-module-bind-body": {
      "begin": "(=?)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "module-item-let-module-bind-name-params": {
      "begin": "\\b([A-Z][_'0-9A-Za-z]*)\\b",
      "end": "(?=[:=])",
      "beginCaptures": {
        "1": { "name": "entity.name.class" }
      },
      "patterns": [
        { "include": "#module-item-let-module-param" }
      ]
    },
    "module-item-let-module-bind-name-params-type-body": {
      "begin": "(?:\\G|^)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "patterns": [
        { "include": "#module-item-let-module-bind-name-params" },
        { "include": "#module-item-let-module-bind-type" },
        { "include": "#module-item-let-module-bind-body" }
      ]
    },
    "module-item-let-module-bind-type": {
      "begin": "(:)",
      "end": "(?=[\\)\\]]|\\b(and)\\b|[=])",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "module-item-let-module-param": {
      "patterns": [
      ]
    },
    "module-item-let-module-rec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(rec)\\b",
      "end": "(?=[\\)\\]]|\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.modifier.rec.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-let-module-bind-name-params-type-body" }
      ]
    },
    "module-item-let-value": {
      "patterns": [
        { "include": "#module-item-let-value-rec" },
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
    "module-item-let-value-and": {
      "begin": "\\b(and)\\b",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
    "module-item-let-value-bind-body": {
      "begin": "(=)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#value-let" },
        { "include": "#value" }
      ]
    },
    "module-item-let-value-bind-name-params": {
      "begin": "(?:\\G|^)[[:space:]]*(?!\\blazy\\b)(?:\\b([_][_'0-9A-Za-z]+)\\b|\\b([a-z][_'0-9A-Za-z]+)\\b)",
      "end": "(?<!:)(?!::)(?=[:=])",
      "beginCaptures": {
        "1": { "name": "comment.line" },
        "2": { "name": "entity.name.function" }
      },
      "patterns": [
        { "include": "#module-item-let-value-param" }
      ]
    },
    "module-item-let-value-bind-name-params-type-body": {
      "begin": "(?!\\b(module|rec)\\b)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "patterns": [
        { "include": "#module-item-let-value-bind-name-params" },
        { "include": "#module-item-let-value-bind-pattern" },
        { "include": "#module-item-let-value-bind-type" },
        { "include": "#module-item-let-value-bind-body" }
      ]
    },
    "module-item-let-value-bind-parens-params": {
      "begin": "(?=\\()",
      "end": "(?!::)(?=[:=])",
      "patterns": [
        {
          "begin": "\\G\\(",
          "end": "\\)",
          "patterns": [
            { "include": "#operator-infix-custom" },
            { "include": "#pattern" },
            { "include": "#pattern-parens-lhs" },
            { "include": "#pattern-parens-rhs" }
          ]
        },
        { "include": "#module-item-let-value-param" }
      ]
    },
    "module-item-let-value-bind-pattern": {
      "begin": "",
      "end": "(?==)",
      "patterns": [
        { "include": "#module-item-let-value-bind-parens-params" },
        { "include": "#pattern" }
      ]
    },
    "module-item-let-value-bind-type": {
      "comment": "FIXME: lookahead",
      "begin": "(:)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b|=(?!>))",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#type-expression" }
      ]
    },
    "module-item-let-value-param": {
      "patterns": [
        { "include": "#module-item-let-value-param-label" },
        { "include": "#module-item-let-value-param-type" },
        { "include": "#module-item-let-value-param-module" },
        { "include": "#pattern" }
      ]
    },
    "module-item-let-value-param-label": {
      "patterns": [
        {
          "begin": "\\b([a-z][_'0-9A-Za-z]*)\\b(::)",
          "end": "(?<=[[:space:]])",
          "beginCaptures": {
            "1": { "name": "constant.language" },
            "2": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#pattern" },
            {
              "begin": "(=)",
              "end": "(\\?)|(?=[[:space:]])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "endCaptures": {
                "1": { "name": "storage.type" }
              },
              "patterns": [
                { "include": "#value" }
              ]
            }
          ]
        }
      ]
    },
    "module-item-let-value-param-module": {
      "comment": "FIXME: merge with pattern-parens",
      "begin": "\\([[:space:]]*(?=\\b(module)\\b)",
      "end": "\\)",
      "patterns": [
        {
          "begin": "\\b(module)\\b",
          "end": "(?=\\))",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "name": "entity.name.class",
              "match": "\\b[A-Z][_'0-9A-Za-z]*\\b"
            }
          ]
        }
      ]
    },
    "module-item-let-value-param-type": {
      "comment": "FIXME: merge with pattern-parens",
      "begin": "\\((?=\\b(type)\\b)",
      "end": "\\)",
      "patterns": [
        {
          "begin": "\\b(type)\\b",
          "end": "(?=\\))",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "name": "support.type",
              "match": "\\b[a-z][_'0-9A-Za-z]*\\b"
            }
          ]
        }
      ]
    },
    "module-item-let-value-rec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(rec)\\b",
      "end": "(?=[\\)\\]]|\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.modifier.rec.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-let-value-and" },
        { "include": "#module-item-let-value-bind-name-params-type-body" }
      ]
    },
    "module-item-module": {
      "comment": "NOTE: this is to support the let-module case without the let prefix",
      "begin": "\\b(module)\\b[[:space:]]*(?!\\btype\\b|$)",
      "end": "(?=\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-item-module-rec" },
        { "include": "#module-item-module-bind-name-params-type-body" }
      ]
    },
    "module-item-module-and": {
      "begin": "\\b(and)\\b",
      "end": "(?=\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.type.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-module-bind-name-params-type-body" }
      ]
    },
    "module-item-module-bind-body": {
      "begin": "(=)",
      "end": "(?=\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "module-item-module-bind-name-params": {
      "begin": "\\b([A-Z][_'0-9A-Za-z]*)\\b",
      "end": "(?=[:=])",
      "beginCaptures": {
        "1": { "name": "entity.name.class" }
      },
      "patterns": [
        { "include": "#module-item-let-value-module-param" }
      ]
    },
    "module-item-module-bind-name-params-type-body": {
      "begin": "(?:\\G|^)",
      "end": "(?=\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "patterns": [
        { "include": "#module-item-module-bind-name-params" },
        { "include": "#module-item-module-bind-type" },
        { "include": "#module-item-module-bind-body" }
      ]
    },
    "module-item-module-bind-type": {
      "begin": "(:)",
      "end": "(?=\\b(and|val)\\b|=)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#module-type-expression" }
      ]
    },
    "module-item-let-value-module-param": {
      "patterns": [
      ]
    },
    "module-item-module-rec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(rec)\\b",
      "end": "(?=\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.modifier.rec.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-module-and" },
        { "include": "#module-item-module-bind-name-params-type-body" }
      ]
    },
    "module-item-module-type": {
      "begin": "\\b(module)\\b[[:space:]]*(?=\\btype\\b|$)",
      "end": "(?=\\b(class|end|external|include|let|module|open|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        {
          "begin": "(?:\\G|^)[[:space:]]*\\b(type)\\b",
          "end": "(?==)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "match": "([A-Z][_'0-9A-Za-z]*)",
              "captures": {
                "1": { "name": "entity.name.class" }
              }
            }
          ]
        },
        {
          "begin": "(=)",
          "end": "(?=\\b(class|end|external|include|let|module|open|type|val)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            { "include": "#comment" },
            { "include": "#module-type-expression" }
          ]
        }
      ]
    },
    "module-item-open": {
      "begin": "\\b(open)\\b",
      "end": "(?=\\b(class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-path" },
        {
          "match": "[A-Z][_'A-Za-z0-9]*",
          "name": "entity.name.class"
        }
      ]
    },
    "module-item-type": {
      "comment": "FIXME: the semi-colon is optional so we can re-use this for hover, which does not print the trailing ;",
      "begin": "\\b(type)\\b",
      "end": "(?=\\b(class|constraint|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#module-item-type-and" },
        { "include": "#module-item-type-constraint" },
        { "include": "#module-item-type-bind" }
      ]
    },
    "module-item-type-and": {
      "begin": "\\b(and)\\b",
      "end": "(?=\\b(and|class|constraint|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "comment": "#module-item-type-bind-args-name-body" }
      ]
    },
    "module-item-type-bind": {
      "comment": "FIXME: only allow module paths before type variables",
      "patterns": [
        { "include": "#module-item-type-bind-nonrec" },
        { "include": "#module-item-type-bind-args-name-body" }
      ]
    },
    "module-item-type-bind-args-single": {
      "match": "([+\\-])?(?:(_)|'([a-z][_'0-9A-Za-z]*)\\b)(?!\\.[A-Z])",
      "captures": {
        "1": { "name": "keyword.other" },
        "2": { "name": "comment.line" },
        "3": { "name": "variable.parameter" }
      }
    },
    "module-item-type-bind-args-parens": {
      "begin": "(?<=\\G|^|\\.)[[:space:]]*\\(",
      "end": "\\)",
      "patterns": [
        { "include": "#module-item-type-bind-args-single" }
      ]
    },
    "module-item-type-bind-args": {
      "begin": "(?<=\\G|^|\\.)[[:space:]]*(?=[_\\-'\\(\\+])",
      "end": "(?<=[_\\)0-9A-Za-z])",
      "patterns": [
        { "include": "#module-item-type-bind-args-single" },
        { "include": "#module-item-type-bind-args-parens" }
      ]
    },
    "module-item-type-bind-args-name-body": {
      "patterns": [
        { "include": "#module-item-type-bind-args" },
        { "include": "#module-expression-path" },
        { "include": "#module-item-type-bind-name" },
        { "include": "#module-item-type-bind-body" }
      ]
    },
    "module-item-type-bind-body": {
      "comment": "FIXME: parsing",
      "begin": "(\\+?=)",
      "end": "(?=\\b(and|class|constraint|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        {
          "comment": "FIXME: add separate rule; parsing",
          "match": "(?:\\G|^)[[:space:]]*\\b(private)\\b",
          "captures": {
            "1": { "name": "keyword.other" }
          }
        },
        {
          "comment": "FIXME: remove this once the pretty printer no longer outputs 'of'",
          "match": "[:|]|\\bof\\b",
          "name": "keyword.other"
        },
        { "include": "#type-expression" },
        {
          "begin": "(\\.\\.)",
          "end": "(?=\\b(and|class|constraint|end|external|include|let|module|open|type|val)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.other" }
          }
        },
        { "include": "#value-expression-literal-constructor-variant" }
      ]
    },
    "module-item-type-bind-name": {
      "match": "\\b([_a-z][_'0-9A-Za-z]*)\\b",
      "name": "entity.name.function"
    },
    "module-item-type-bind-nonrec": {
      "begin": "(?:\\G|^)[[:space:]]*\\b(nonrec)\\b",
      "end": "(?=\\b(and|class|constraint|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "storage.modifier.nonrec.ocaml" }
      },
      "patterns": [
        { "include": "#module-item-type-bind-args-name-body" }
      ]
    },
    "module-item-type-constraint": {
      "comment": "FIXME: proper parsing",
      "begin": "\\b(constraint)\\b",
      "end": "(?=\\b(and|class|constraint|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
      ]
    },
    "module-type-expression": {
      "patterns": [
        { "include": "#module-expression" }
      ]
    },
    "operator": {
      "patterns": [
        { "include": "#operator-infix" },
        { "include": "#operator-prefix" }
      ]
    },
    "operator-infix-builtin": {
      "match": ":=",
      "name": "keyword.operator"
    },
    "operator-infix": {
      "patterns": [
        { "include": "#operator-infix-builtin" },
        { "include": "#operator-infix-custom" },
        { "include": "#operator-infix-custom-hash" }
      ]
    },
    "operator-infix-custom": {
      "match": "[\\-@*/&%^+<=>|$][\\-:!?.@*/&%^+<=>|~$\\\\]*",
      "name": "keyword.operator"
    },
    "operator-infix-custom-hash": {
      "match": "#[\\-:!?.@*/&%^+<=>|~$]+",
      "name": "keyword.operator"
    },
    "operator-prefix": {
      "patterns": [
        { "include": "#operator-prefix-bang" },
        { "include": "#operator-prefix-label-token" }
      ]
    },
    "operator-prefix-bang": {
      "match": "![\\-:!?.@*/&%^+<=>|~$]*",
      "name": "keyword.operator"
    },
    "operator-prefix-label-token": {
      "match": "[?~][\\-:!?.@*/&%^+<=>|~$]+",
      "name": "keyword.operator"
    },
    "pattern": {
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-path" },
        {
          "comment": "FIXME",
          "match": "\\b(lazy)\\b",
          "captures": {
            "1": { "name": "keyword.other" }
          }
        },
        { "include": "#pattern-parens" },
        { "include": "#pattern-atomic" }
      ]
    },
    "pattern-atomic": {
      "patterns": [
        { "include": "#value-literal" },
        { "include": "#pattern-list" },
        { "include": "#pattern-record" },
        { "include": "#pattern-variable" }
      ]
    },
    "pattern-guard": {
      "begin": "\\b(when)\\b",
      "end": "(?=->)",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#value" }
      ]
    },
    "pattern-list": {
      "patterns": [
        {
          "match": "::",
          "name": "constant.language"
        },
        {
          "begin": "(\\[)(?![@%])",
          "end": "(\\])",
          "beginCaptures": {
            "1": { "name": "constant.language.list.ocaml" }
          },
          "endCaptures": {
            "1": { "name": "constant.language.list.ocaml" }
          },
          "patterns": [
            { "include": "#value-literal-list-separator" },
            { "include": "#pattern" }
          ]
        }
      ]
    },
    "pattern-parens": {
      "begin": "(?=\\()",
      "end": "\\)",
      "patterns": [
        { "include": "#pattern-parens-lhs" },
        { "include": "#pattern-parens-rhs" }
      ]
    },
    "pattern-parens-lhs": {
      "begin": "(?:\\(|(,))",
      "end": "(?=(?:[,:\\)]|\\bas\\b))",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#pattern" }
      ]
    },
    "pattern-parens-rhs": {
      "patterns": [
        { "include": "#pattern-parens-rhs-alias" },
        { "include": "#pattern-parens-rhs-type" }
      ]
    },
    "pattern-parens-rhs-alias": {
      "begin": "\\b(as)\\b",
      "end": "(?=[,\\)])",
      "beginCaptures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#pattern-variable" }
      ]
    },
    "pattern-parens-rhs-type": {
      "begin": "(:)",
      "end": "(?=\\))",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#type-expression" }
      ]
    },
    "pattern-record": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#comment" },
        { "include": "#pattern-record-item" }
      ]
    },
    "pattern-record-field": {
      "begin": "\\b([_][_'0-9A-Za-z]*)\\b|\\b([a-z][_'0-9A-Za-z]*)\\b",
      "end": "(?:(,)|(?=\\}))",
      "beginCaptures": {
        "1": { "name": "comment.line" },
        "2": { "name": "constant.language.field.ocaml" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#comment" },
        {
          "begin": "\\G(:)",
          "end": "(?=[,\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.operator.ocaml" }
          },
          "patterns": [
            { "include": "#pattern" }
          ]
        }
      ]
    },
    "pattern-record-item": {
      "patterns": [
        { "include": "#module-expression-path" },
        { "include": "#pattern-record-field" }
      ]
    },
    "pattern-variable": {
      "patterns": [
        {
          "match": "\\b(_(?:[a-z][_'0-9A-Za-z]*)?)\\b(?!\\.[A-Z])",
          "captures": {
            "1": { "name": "comment.line" }
          }
        },
        {
          "match": "\\b([a-z][_'0-9A-Za-z]*)\\b(?!\\.[A-Z])",
          "captures": {
            "1": { "name": "variable.parameter" }
          }
        }
      ]
    },
    "type-expression": {
      "comments": "FIXME: higher-rank, objects, poly-variants, etc.",
      "patterns": [
        { "include": "#attribute" },
        { "include": "#comment" },
        { "include": "#module-expression-path" },
        { "include": "#type-expression-label" },
        { "include": "#type-expression-arrow" },
        { "include": "#type-expression-constructor" },
        { "include": "#type-expression-object" },
        { "include": "#type-expression-parens" },
        { "include": "#type-expression-polymorphic-variant" },
        { "include": "#type-expression-record" },
        { "include": "#type-expression-variable" }
      ]
    },
    "type-expression-arrow": {
      "match": "->",
      "name": "keyword.operator"
    },
    "type-expression-constructor": {
      "match": "(_)(?![0-9A-Za-z])|\\b([_a-z][_'0-9A-Za-z]*)\\b(?!\\.[A-Z])",
      "captures": {
        "1": { "name": "variable.parameter" },
        "2": { "name": "support.type" }
      }
    },
    "type-expression-label": {
      "begin": "\\b([_a-z][_'0-9A-Za-z]*)\\b(::)",
      "end": "(?<=->)",
      "beginCaptures": {
        "1": { "name": "constant.language" },
        "2": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#type-expression" },
        {
          "match": "(\\?)",
          "captures": {
            "1": { "name": "keyword.other" }
          }
        }
      ]
    },
    "type-expression-object": {
      "comment": "FIXME: separate sub-rules",
      "begin": "(<)",
      "end": "(>)",
      "captures": {
        "1": { "name": "entity.name.function" }
      },
      "patterns": [
        {
          "begin": "(\\.\\.)",
          "end": "(?=>)",
          "beginCaptures": {
            "1": { "name": "constant.language" }
          }
        },
        {
          "comment": "FIXME: method item",
          "begin": "(?=[_a-z])",
          "end": "(,)|(?=>)",
          "endCaptures": {
            "1": { "name": "keyword.other" }
          },
          "patterns": [
            {
              "comment": "FIXME: method name",
              "begin": "(?=[_a-z])",
              "end": "(?=:)",
              "patterns": [
                {
                  "match": "\\b([_a-z][_'0-9A-Za-z]*)\\b",
                  "captures": {
                    "1": { "name": "constant.language" }
                  }
                }
              ]
            },
            {
              "comment": "FIXME: method type",
              "begin": "(:)",
              "end": "(?=[,>])",
              "beginCaptures": {
                "1": { "name": "keyword.other" }
              },
              "patterns": [
                { "include": "#type-expression" }
              ]
            }
          ]
        }
      ]
    },
    "type-expression-parens": {
      "comment": "FIXME: proper tuple types",
      "begin": "\\(",
      "end": "\\)",
      "patterns": [
        {
          "match": ",",
          "name": "keyword.other"
        },
        { "include": "#type-expression" }
      ]
    },
    "type-expression-polymorphic-variant": {
      "comment": "FIXME: proper parsing",
      "begin": "(\\[)",
      "end": "(\\])",
      "captures": {
        "1": { "name": "entity.name.function" }
      },
      "patterns": [
        {
          "match": "[<>|]|\\bof\\b",
          "name": "keyword.other"
        },
        { "include": "#value-literal-constructor-variant-polymorphic" },
        { "include": "#type-expression" }
      ]
    },
    "type-expression-record": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#type-expression-record-item" }
      ]
    },
    "type-expression-record-field": {
      "comment": "FIXME: proper chaining with mutable, …",
      "begin": "(\\bmutable\\b)?[[:space:]]*(?!\\bmutable\\b)\\b([_a-z][_'0-9A-Za-z]*)\\b",
      "end": "(?:(,)|(?=\\}))",
      "beginCaptures": {
        "1": { "name": "keyword.other" },
        "2": { "name": "constant.language.field.ocaml" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#comment" },
        {
          "begin": "(:)",
          "end": "(?=[,\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.operator.ocaml" }
          },
          "patterns": [
            { "include": "#type-expression" }
          ]
        }
      ]
    },
    "type-expression-record-item": {
      "patterns": [
        { "include": "#comment" },
        { "include": "#module-expression-path" },
        { "include": "#type-expression-record-field" }
      ]
    },
    "type-expression-variable": {
      "match": "'([_a-z][_'0-9A-Za-z]*)\\b(?!\\.[A-Z])",
      "captures": {
        "1": { "name": "parameter.variable" }
      }
    },
    "value": {
      "patterns": [
        { "include": "#attribute" },
        { "include": "#comment" },
        { "include": "#extension-node" },
        { "include": "#module-expression-path" },
        { "include": "#value-let" },
        { "include": "#operator" },
        { "include": "#value-builtin" },
        { "include": "#value-if-then-else" },
        { "include": "#value-atomic" },
        { "include": "#value-record-path" }
      ]
    },
    "value-atomic": {
      "patterns": [
        { "include": "#value-literal" },
        { "include": "#value-literal-list" },
        { "include": "#value-fun" },
        { "include": "#value-block" },
        { "include": "#value-label" },
        { "include": "#value-parens" },
        { "include": "#value-match" },
        { "include": "#value-try" }
      ]
    },
    "value-block": {
      "begin": "\\b(begin)\\b",
      "end": "\\b(end)\\b",
      "captures": {
        "1": { "name": "keyword.other" }
      },
      "patterns": [
        { "include": "#value" }
      ]
    },
    "value-builtin": {
      "match": "\\b(assert|decr|failwith|fprintf|ignore|incr|land|lazy|lor|lsl|lsr|lxor|mod|new|not|printf|ref)\\b",
      "name": "keyword.operator"
    },
    "value-fun": {
      "begin": "\\b(fun)\\b",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|in|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#value-fun-pattern-match-rule-lhs" },
        { "include": "#value-fun-pattern-match-rule-rhs" }
      ]
    },
    "value-fun-pattern-match-rule-lhs": {
      "begin": "(\\|)",
      "end": "(?=->)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#pattern-guard" },
        { "include": "#pattern" }
      ]
    },
    "value-fun-pattern-match-rule-rhs": {
      "begin": "(->)",
      "end": "(?=[\\)\\]\\|]|\\b(and|class|end|external|in|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#value" }
      ]
    },
    "value-if-then-else": {
      "begin": "(?=\\b(if)\\b)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|in|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.control" }
      },
      "patterns": [
        {
          "begin": "\\b(if)\\b",
          "end": "(?=\\b(then)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#value" }
          ]
        },
        {
          "begin": "\\b(then)\\b",
          "end": "(?=\\b(else)\\b)",
          "captures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#value" }
          ]
        },
        {
          "begin": "\\b(else)\\b",
          "end": "(?=[\\)\\]]|\\b(and|class|end|external|in|include|let|module|open|type|val)\\b)",
          "beginCaptures": {
            "1": { "name": "keyword.control" }
          },
          "patterns": [
            { "include": "#value" }
          ]
        }
      ]
    },
    "value-label": {
      "begin": "\\b([_a-z][_'0-9A-Za-z]*)\\b(::)(\\?)?",
      "end": "(?![[:space:]])",
      "beginCaptures": {
        "1": { "name": "constant.language" },
        "2": { "name": "keyword.other" },
        "3": { "name": "storage.type" }
      },
      "patterns": [
        { "include": "#value" }
      ]
    },
    "value-let": {
      "patterns": [
        { "include": "#module-item-in" },
        { "include": "#module-item-let" }
      ]
    },
    "value-literal": {
      "patterns": [
        { "include": "#value-literal-boolean" },
        { "include": "#value-literal-char" },
        { "include": "#value-literal-numeric" },
        { "include": "#value-literal-string" },
        { "include": "#value-literal-constructor-variant" },
        { "include": "#value-literal-constructor-variant-polymorphic" },
        { "include": "#value-literal-unit" }
      ]
    },
    "value-literal-boolean": {
      "match": "\\b(false|true)\\b",
      "name": "constant.language.boolean.ocaml"
    },
    "value-literal-char": {
      "match": "'([[:graph:]]|\\\\[\\\\\"'\n\t\b\r ]|\\\\[0-9][0-9][0-9]|\\\\x[0-9A-Fa-f][0-9A-Fa-f]|\\\\o[0-3][0-7][0-7])'",
      "name": "constant.character"
    },
    "value-literal-constructor-variant": {
      "match": "\\b([A-Z][_'0-9A-Za-z]*)\\b(?!\\.)",
      "captures": {
        "1": { "name": "constant.language.ocaml" }
      }
    },
    "value-literal-constructor-variant-polymorphic": {
      "match": "(`)([A-Z][_'0-9A-Za-z]*)\\b(?!\\.)",
      "captures": {
        "1": { "name": "variable.parameter" },
        "2": { "name": "constant.language.ocaml" }
      }
    },
    "value-literal-list": {
      "begin": "(\\[)(?![@%])",
      "end": "(\\])",
      "beginCaptures": {
        "1": { "name": "constant.language.list.ocaml" }
      },
      "endCaptures": {
        "1": { "name": "constant.language.list.ocaml" }
      },
      "patterns": [
        { "include": "#value-literal-list-separator" },
        { "include": "#value" },
        { "include": "#value-literal-list" }
      ]
    },
    "value-literal-list-separator": {
      "match": "(;)",
      "captures": {
        "1": { "name": "keyword.operator" }
      }
    },
    "value-literal-numeric": {
      "match": "\\b(?<=[^$])((0(x|X)[0-9a-fA-F]+)|(0(o|O)[0-7]+)|(0(b|B)(0|1)+)|(([0-9]+(\\.[0-9]+)?))([eE]([+-]?)[0-9]+(\\.[0-9]+)?)?)\\b",
      "name": "constant.language.numeric.ocaml"
    },
    "value-literal-string": {
			"name": "string.double.ocaml",
			"begin": "\"",
			"end": "\"|(?:[^\\\\\\n]$)",
      "patterns": [
        {
          "match": "(@)([ \\[\\],.]|\\\\n)",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "constant.language" }
          }
        },
        {
          "match": "(%)\\b(identity)\\b",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "constant.language" }
          }
        },
        {
          "match": "(%)([ads])?",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "variable.parameter" }
          }
        }
      ]
    },
    "value-literal-unit": {
      "match": "\\(\\)",
      "name": "constant.language.unit.ocaml"
    },
    "value-match": {
      "begin": "(?=\\b(match)\\b)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "patterns": [
        { "include": "#value-match-head" },
        { "include": "#value-match-body" }
      ]
    },
    "value-match-head": {
      "begin": "\\b(match)\\b",
      "end": "(?=\\b(with)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.control.ocaml" }
      },
      "patterns": [
        {
          "comment": "FIXME: parens; anchor",
          "include": "#value"
        }
      ]
    },
    "value-match-body": {
      "begin": "\\b(with)\\b",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.control.ocaml" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#value-match-pattern-match-rule" }
      ]
    },
    "value-match-pattern-match-rule": {
      "patterns": [
        { "include": "#value-match-pattern-match-rule-lhs" },
        { "include": "#value-match-pattern-match-rule-rhs" }
      ]
    },
    "value-match-pattern-match-rule-lhs": {
      "begin": "(\\|)",
      "end": "(?=->)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#pattern-guard" },
        { "include": "#pattern" }
      ]
    },
    "value-match-pattern-match-rule-rhs": {
      "begin": "(->)",
      "end": "(?=[\\)\\]\\|]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#value" }
      ]
    },
    "value-object-look": {
      "comment": "FIXME: is there a better way than listing all the keywords?",
      "begin": "(?:\\G|^)[[:space:]]*(?=method)",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#object-item" }
      ]
    },
    "value-parens": {
      "begin": "(?=\\()",
      "end": "\\)",
      "patterns": [
        { "include": "#value-parens-lhs" }
      ]
    },
    "value-parens-lhs": {
      "begin": "(?:\\(|(,))",
      "end": "(?=(?:[,:\\)]|\\bas\\b))",
      "beginCaptures": {
        "1": { "name": "keyword.operator" }
      },
      "patterns": [
        { "include": "#value" }
      ]
    },
    "value-record": {
      "begin": "\\{",
      "end": "\\}",
      "patterns": [
        { "include": "#value-record-item" }
      ]
    },
    "value-record-field": {
      "begin": "(\\.\\.\\.)?\\b([_a-z][_'0-9A-Za-z]*)",
      "end": "(?:(,)|(?=\\}))",
      "beginCaptures": {
        "1": { "name": "keyword.other" },
        "2": { "name": "constant.language.field.ocaml" }
      },
      "endCaptures": {
        "1": { "name": "keyword.operator.ocaml" }
      },
      "patterns": [
        {
          "begin": "\\G(:)",
          "end": "(?=[,\\}])",
          "beginCaptures": {
            "1": { "name": "keyword.operator.ocaml" }
          },
          "patterns": [
            { "include": "#value" }
          ]
        }
      ]
    },
    "value-record-item": {
      "patterns": [
        { "include": "#module-expression-path" },
        { "include": "#value-record-field" }
      ]
    },
    "value-record-path": {
      "begin": "\\b[a-z][_'0-9A-Za-z]*\\b",
      "end": "(?!\\.)",
      "patterns": [
        {
          "match": "(\\.)[[:space:]]*\\(([a-z][_'0-9A-Za-z]*)\\)",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "variable.parameter" }
          }
        },
        {
          "match": "(\\.)[[:space:]]*\\b([A-Z][_'0-9A-Za-z]*)\\b",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "entity.name.class" }
          }
        },
        {
          "match": "(\\.)[[:space:]]*\\b([a-z][_'0-9A-Za-z]*)\\b",
          "captures": {
            "1": { "name": "keyword.operator" },
            "2": { "name": "constant.language" }
          }
        }
      ]
    },
    "value-try": {
      "begin": "(?=\\b(try)\\b)",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "patterns": [
        { "include": "#value-try-head" },
        { "include": "#value-try-body" }
      ]
    },
    "value-try-head": {
      "begin": "\\b(try)\\b",
      "end": "(?=\\b(with)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.control.ocaml" }
      }
    },
    "value-try-body": {
      "begin": "\\b(with)\\b",
      "end": "(?=[\\)\\]]|\\b(and|class|end|external|include|let|module|open|type|val)\\b)",
      "beginCaptures": {
        "1": { "name": "keyword.control.ocaml" }
      },
      "patterns": [
        { "include": "#comment" },
        { "include": "#value-match-pattern-match-rule" }
      ]
    },
    "value-record-look": {
      "begin": "(?=\\.\\.\\.|([A-Z][_'0-9A-Za-z]*\\.)*([a-z][_'0-9A-Za-z]*)[[:space:]]*[,:\\}])",
      "end": "(?=\\})",
      "patterns": [
        { "include": "#value-record-item" }
      ]
    }
  }
}
